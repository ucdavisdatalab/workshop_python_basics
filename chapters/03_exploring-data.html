
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>3. Exploring Data &#8212; Python Basics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/03_exploring-data';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4. Organizing Code" href="04_organizing-code.html" />
    <link rel="prev" title="2. Data Structures" href="02_pandas-basics.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/datalab-logo-full-color-rgb-1.png" class="logo__image only-light" alt="Python Basics - Home"/>
    <script>document.write(`<img src="../_static/datalab-logo-full-color-rgb-1.png" class="logo__image only-dark" alt="Python Basics - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    Overview
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Python Basics</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_python-basics.html">1. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_pandas-basics.html">2. Data Structures</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">3. Exploring Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_organizing-code.html">4. Organizing Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_appendix.html">5. Appendix</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Back Matter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="assessment.html">Assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Acknowledgements</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/ucdavisdatalab/workshop_python_basics" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chapters/03_exploring-data.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Exploring Data</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">3.1. Setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#packages">3.1.1. Packages</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data">3.1.2. Data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#iterating-over-data">3.2. Iterating Over Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#for-loops">3.2.1. For-Loops</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#list-comprehensions">3.2.2. List Comprehensions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aggregate-functions">3.3. Aggregate Functions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aggregating-a-column">3.3.1. Aggregating a Column</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aggregating-within-groups">3.3.2. Aggregating within Groups</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-visualization-in-python">3.4. Data Visualization in Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-packages">3.5. Installing Packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-to-visualize">3.6. Preparing to Visualize</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-plotnine">3.6.1. Import plotnine</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-jupyter">3.6.2. Configure Jupyter</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-cleaning">3.6.3. Data Cleaning</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-grammar-of-graphics">3.7. The Grammar of Graphics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#layer-1-data">3.7.1. Layer 1: Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#layer-2-geometry">3.7.2. Layer 2: Geometry</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#layer-3-aesthetics">3.7.3. Layer 3: Aesthetics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#layer-4-scales">3.7.4. Layer 4: Scales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-plots">3.7.5. Saving Plots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-bar-plot">3.7.6. Example: Bar Plot</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-design">3.7.7. Visualization Design</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">3.8. Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">3.8.1. Exercise</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">3.8.2. Exercise</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">3.8.3. Exercise</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="exploring-data">
<h1><span class="section-number">3. </span>Exploring Data<a class="headerlink" href="#exploring-data" title="Link to this heading">#</a></h1>
<p>Now that you have a solid foundation in the basic functions and data structures
of Python, you can move on to using it for data analysis. In this chapter,
you’ll learn how to efficiently explore and summarize with visualizations and
statistics. Along the way, you’ll also learn how to apply functions along
entire sets of data in Pandas DataFrames and Series.</p>
<div class="admonition-learning-objectives admonition">
<p class="admonition-title">Learning Objectives</p>
<ul class="simple">
<li><p>Describe how Python iterates over data</p></li>
<li><p>Write loops to do things repeatedly</p></li>
<li><p>Write list comprehensions to do things repeatedly</p></li>
<li><p>Use Pandas aggregation methods to explore a data set</p></li>
<li><p>Prepare data for visualization</p></li>
<li><p>Describe the grammar of graphics</p></li>
<li><p>Use the grammar of graphics to produce a plot</p></li>
<li><p>Identify where to go to learn more about making effective visualizations</p></li>
</ul>
</div>
<section id="setup">
<h2><span class="section-number">3.1. </span>Setup<a class="headerlink" href="#setup" title="Link to this heading">#</a></h2>
<section id="packages">
<h3><span class="section-number">3.1.1. </span>Packages<a class="headerlink" href="#packages" title="Link to this heading">#</a></h3>
<p>As in the last chapter, you will be working with two primary packages: NumPy
and Pandas. Later, you will load another set of packages to visualize your
data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data">
<h3><span class="section-number">3.1.2. </span>Data<a class="headerlink" href="#data" title="Link to this heading">#</a></h3>
<p>We will continue working with the banknotes data set. Once you’ve imported your
packages, load this data in as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">banknotes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/banknotes.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You’re now ready to go.</p>
</section>
</section>
<section id="iterating-over-data">
<span id="iteration"></span><h2><span class="section-number">3.2. </span>Iterating Over Data<a class="headerlink" href="#iterating-over-data" title="Link to this heading">#</a></h2>
<p>Before we go into data exploration in full, it’s important to understand how
Python/Pandas computes summary statistics about a data set.
<a class="reference internal" href="01_python-basics.html#summarizing-columns"><span class="std std-numref">Section 1.7.2</span></a> introduced column-wise operations in Pandas; you
will learn more of them below. These operations are a convenient and efficient
way to compute multiple results at once, and with only a few lines of code.</p>
<p>Under the hood, Pandas has to <strong>iterate</strong> over each value in a cell to perform
operations like <code class="docutils literal notranslate"><span class="pre">.mean</span></code> or <code class="docutils literal notranslate"><span class="pre">.min</span></code>. We can do this too using a <strong>for-loop</strong>.</p>
<section id="for-loops">
<h3><span class="section-number">3.2.1. </span>For-Loops<a class="headerlink" href="#for-loops" title="Link to this heading">#</a></h3>
<p>For-loops iterate over some object and compute something for each element. Each
one of these computations is one <strong>iteration</strong>. A for-loop begins with the
<code class="docutils literal notranslate"><span class="pre">for</span></code> keyword, followed by:</p>
<ul class="simple">
<li><p>A placeholder variable, which will be automatically signed to an element at
the beginning of each iteration</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">in</span></code> keyword</p></li>
<li><p>An object with elements</p></li>
<li><p>A colon <code class="docutils literal notranslate"><span class="pre">:</span></code></p></li>
</ul>
<p>Code in the body of the loop must be indented by 4 spaces.</p>
<p>For example, to print out all the column names in <code class="docutils literal notranslate"><span class="pre">banknotes.columns</span></code>, you can
write:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">banknotes</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>currency_code
country
currency_name
name
gender
bill_count
profession
known_for_being_first
current_bill_value
prop_total_bills
first_appearance_year
death_year
comments
hover_text
has_portrait
id
scaled_bill_value
</pre></div>
</div>
</div>
</div>
<p>Within the indented part of a for-loop, you can compute values, check
conditions, etc.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">banknotes</span><span class="p">[</span><span class="s2">&quot;bill_count&quot;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.33
0.33
0.33
0.33
0.33
0.33
0.33
0.33
0.33
0.33
0.33
0.33
0.33
0.33
0.33
0.25
0.25
0.25
0.25
0.33
0.33
0.33
0.5
0.5
0.33
0.5
0.33
0.33
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.33
0.33
0.33
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.33
0.33
0.33
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5
</pre></div>
</div>
</div>
</div>
<p>Oftentimes you want to save the result of the code you perform within a
for-loop. The easiest way to do this is by creating an empty list and using
<code class="docutils literal notranslate"><span class="pre">append</span></code> to add values to it.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">banknotes</span><span class="p">[</span><span class="s2">&quot;current_bill_value&quot;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">%</span> <span class="mi">25</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="n">result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[100,
 100,
 50,
 50,
 50,
 100,
 100,
 1000,
 500,
 200,
 100,
 50,
 50,
 50,
 100,
 200,
 100,
 50,
 200,
 200,
 100,
 50,
 100,
 5000,
 1000,
 10000,
 20000,
 2000,
 50000,
 20000,
 2000,
 10000,
 100000,
 1000,
 20000,
 5000,
 50000,
 2000,
 10000,
 10000,
 5000,
 20000,
 50000,
 2000,
 1000,
 2000,
 5000,
 1000,
 200,
 500,
 5000,
 2000,
 1000,
 500,
 200,
 100,
 200,
 200,
 200,
 500,
 2000,
 100,
 2000,
 100,
 100,
 500,
 50,
 50,
 200,
 50,
 100,
 500,
 100000,
 5000,
 100000,
 10000,
 50000,
 20000,
 50000,
 20000,
 2000,
 1000,
 2000,
 10000,
 200,
 100,
 50,
 2000,
 500,
 10000,
 5000,
 1000,
 500,
 1000,
 100,
 50,
 500,
 1000,
 10000,
 5000,
 5000,
 500,
 200,
 100,
 50,
 1000,
 5000,
 1000,
 50000,
 10000,
 1000,
 200,
 50,
 500,
 2000,
 100,
 500,
 500,
 1000,
 1000,
 1000,
 500,
 200,
 200,
 100,
 100,
 500,
 1000,
 100,
 200,
 1000,
 50,
 100,
 100,
 50,
 100,
 200,
 50,
 500,
 100,
 500,
 200,
 50,
 1000,
 1000,
 1000,
 50,
 100,
 5000,
 2000,
 100,
 1000,
 500,
 200,
 50,
 200,
 500,
 100,
 50,
 1000,
 100000,
 200,
 500,
 1000,
 5000,
 10000,
 20000,
 50000,
 50,
 100,
 200,
 50,
 100,
 200,
 50,
 1000,
 200,
 100,
 500,
 50,
 100,
 1000,
 100,
 500,
 200,
 50,
 2000,
 500,
 50,
 200,
 100,
 50,
 100,
 200]
</pre></div>
</div>
</div>
</div>
</section>
<section id="list-comprehensions">
<h3><span class="section-number">3.2.2. </span>List Comprehensions<a class="headerlink" href="#list-comprehensions" title="Link to this heading">#</a></h3>
<p>A more efficient and succinct way to perform certain <code class="docutils literal notranslate"><span class="pre">append</span></code> operations is
with a <strong>list comprehension</strong>. A list comprehension is very similar to a
for-loop, but it automatically creates a new list based on what your iterations
do. This means you do not need to create an empty list ahead of time.</p>
<p>The syntax for a list comprehension includes the keywords <code class="docutils literal notranslate"><span class="pre">for</span></code> and <code class="docutils literal notranslate"><span class="pre">in</span></code>, just
like a for-loop. The difference is that in the list comprehension, the repeated
code comes <em>before</em> the <code class="docutils literal notranslate"><span class="pre">for</span></code> keyword rather than after it, and the entire
expression is enclosed in square brackets <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code>.</p>
<p>Here’s a list comprehension that divides each value in the <code class="docutils literal notranslate"><span class="pre">current_bill_value</span></code>
column by 2:</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">value</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">banknotes</span><span class="p">[</span><span class="s2">&quot;current_bill_value&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[50.0,
 50.0,
 25.0,
 10.0,
 5.0,
 25.0,
 5.0,
 10.0,
 5.0,
 25.0,
 50.0,
 50.0,
 10.0,
 2.5,
 10.0,
 500.0,
 250.0,
 100.0,
 50.0,
 25.0,
 5.0,
 2.5,
 1.0,
 25.0,
 25.0,
 5.0,
 50.0,
 100.0,
 50.0,
 25.0,
 5.0,
 5.0,
 10.0,
 100.0,
 10.0,
 100.0,
 50.0,
 10.0,
 2.5,
 25.0,
 50.0,
 5.0,
 5.0,
 5.0,
 5.0,
 5.0,
 10.0,
 2500.0,
 500.0,
 5000.0,
 10000.0,
 1000.0,
 25000.0,
 10000.0,
 1000.0,
 5000.0,
 50000.0,
 500.0,
 10000.0,
 2500.0,
 25000.0,
 1000.0,
 5000.0,
 5000.0,
 2500.0,
 10000.0,
 25000.0,
 1000.0,
 500.0,
 1000.0,
 2500.0,
 500.0,
 100.0,
 250.0,
 2500.0,
 1000.0,
 500.0,
 250.0,
 100.0,
 50.0,
 100.0,
 100.0,
 100.0,
 250.0,
 1000.0,
 50.0,
 1000.0,
 50.0,
 50.0,
 10.0,
 250.0,
 2.5,
 25.0,
 10.0,
 5.0,
 2.5,
 5.0,
 10.0,
 25.0,
 2.5,
 1.0,
 100.0,
 0.5,
 5.0,
 10.0,
 25.0,
 50.0,
 250.0,
 50000.0,
 2500.0,
 50000.0,
 5000.0,
 25000.0,
 10000.0,
 25000.0,
 10000.0,
 1000.0,
 500.0,
 1000.0,
 5000.0,
 100.0,
 50.0,
 25.0,
 10.0,
 1000.0,
 250.0,
 5000.0,
 2500.0,
 500.0,
 250.0,
 500.0,
 50.0,
 25.0,
 250.0,
 500.0,
 5000.0,
 2500.0,
 2500.0,
 250.0,
 100.0,
 10.0,
 50.0,
 25.0,
 500.0,
 2500.0,
 500.0,
 25000.0,
 5000.0,
 500.0,
 100.0,
 10.0,
 25.0,
 250.0,
 1000.0,
 50.0,
 250.0,
 250.0,
 500.0,
 500.0,
 500.0,
 250.0,
 10.0,
 100.0,
 100.0,
 50.0,
 50.0,
 10.0,
 250.0,
 500.0,
 5.0,
 50.0,
 2.5,
 10.0,
 100.0,
 500.0,
 2.5,
 25.0,
 50.0,
 5.0,
 10.0,
 50.0,
 10.0,
 5.0,
 5.0,
 25.0,
 50.0,
 100.0,
 25.0,
 250.0,
 50.0,
 250.0,
 100.0,
 10.0,
 25.0,
 500.0,
 500.0,
 500.0,
 0.5,
 2.5,
 5.0,
 10.0,
 25.0,
 50.0,
 2500.0,
 1000.0,
 50.0,
 500.0,
 250.0,
 100.0,
 25.0,
 5.0,
 10.0,
 100.0,
 250.0,
 10.0,
 50.0,
 25.0,
 500.0,
 50000.0,
 100.0,
 250.0,
 500.0,
 2500.0,
 5000.0,
 10000.0,
 25000.0,
 5.0,
 10.0,
 5.0,
 2.5,
 2.5,
 5.0,
 10.0,
 25.0,
 50.0,
 100.0,
 5.0,
 2.5,
 25.0,
 10.0,
 50.0,
 100.0,
 25.0,
 500.0,
 10.0,
 100.0,
 50.0,
 250.0,
 5.0,
 2.5,
 1.0,
 0.5,
 25.0,
 1.0,
 2.5,
 0.5,
 10.0,
 50.0,
 5.0,
 500.0,
 50.0,
 10.0,
 250.0,
 100.0,
 25.0,
 1000.0,
 250.0,
 25.0,
 1.0,
 100.0,
 10.0,
 50.0,
 5.0,
 2.5,
 5.0,
 10.0,
 25.0,
 50.0,
 100.0]
</pre></div>
</div>
</div>
</div>
<p>List comprehensions can optionally include the <code class="docutils literal notranslate"><span class="pre">if</span></code> keyword and a condition at
the end, to filter out some elements of the list:</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">year</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">banknotes</span><span class="p">[</span><span class="s2">&quot;first_appearance_year&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">year</span> <span class="o">&gt;</span> <span class="mi">2012</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2018,
 2018,
 2018,
 2018,
 2018,
 2018,
 2018,
 2018,
 2019,
 2018,
 2019,
 2018,
 2018,
 2017,
 2018,
 2017,
 2017,
 2015,
 2015,
 2015,
 2015,
 2014,
 2014,
 2014,
 2014,
 2014,
 2014,
 2016,
 2021,
 2020,
 2017,
 2016,
 2016,
 2016,
 2016,
 2016,
 2016,
 2015,
 2017,
 2014,
 2017,
 2013,
 2020,
 2020,
 2021,
 2021,
 2015,
 2016,
 2015,
 2015,
 2015,
 2015,
 2013,
 2020,
 2017,
 2013,
 2013,
 2019,
 2015,
 2018,
 2018,
 2018,
 2018]
</pre></div>
</div>
</div>
</div>
<p>This is similar to subsetting in Pandas.</p>
<p>Note that you can assign the results of a list comprehension to a new variable
and then perform further computations on them:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recent_years</span> <span class="o">=</span> <span class="p">[</span><span class="n">year</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">banknotes</span><span class="p">[</span><span class="s2">&quot;first_appearance_year&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">year</span> <span class="o">&gt;</span> <span class="mi">2012</span><span class="p">]</span>
<span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">recent_years</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(2017.0)
</pre></div>
</div>
</div>
</div>
<p>You can learn more about comprehensions in the <a class="reference external" href="https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions">official Python
documentation</a>.</p>
</section>
</section>
<section id="aggregate-functions">
<span id="id1"></span><h2><span class="section-number">3.3. </span>Aggregate Functions<a class="headerlink" href="#aggregate-functions" title="Link to this heading">#</a></h2>
<section id="aggregating-a-column">
<span id="id2"></span><h3><span class="section-number">3.3.1. </span>Aggregating a Column<a class="headerlink" href="#aggregating-a-column" title="Link to this heading">#</a></h3>
<p>In <a class="reference internal" href="01_python-basics.html#summarizing-columns"><span class="std std-numref">Section 1.7.2</span></a>, you learned how to compute the mean, minimum,
and maximum values from a Series. Pandas offers a more generalized way to
handle these functions through its <code class="docutils literal notranslate"><span class="pre">.aggregate</span></code> method. This method
<strong>aggregates</strong> the elements of Series, reducing the Series to a smaller number
of values (usually one value).</p>
<p>For example, to compute the median of all values in <code class="docutils literal notranslate"><span class="pre">first_appearance_year</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">banknotes</span><span class="p">[</span><span class="s2">&quot;first_appearance_year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(1996.0)
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">.agg</span></code> method is an alias for <code class="docutils literal notranslate"><span class="pre">.aggregate</span></code>. The <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.aggregate.html">Pandas
documentation</a> advises that you use the alias:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">banknotes</span><span class="p">[</span><span class="s2">&quot;first_appearance_year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(1996.0)
</pre></div>
</div>
</div>
</div>
<p>You can pass functions to <code class="docutils literal notranslate"><span class="pre">.agg</span></code> in addition to names of functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">banknotes</span><span class="p">[</span><span class="s2">&quot;first_appearance_year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/t5/01_l718x40d70dt2m4lyvrb40000gp/T/ipykernel_49155/2993909395.py:1: FutureWarning: The provided callable &lt;function median at 0x1142e3ec0&gt; is currently using Series.median. In a future version of pandas, the provided callable will be used directly. To keep current behavior pass the string &quot;median&quot; instead.
  banknotes[&quot;first_appearance_year&quot;].agg(np.median)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(1996.0)
</pre></div>
</div>
</div>
</div>
<p>The method is particularly powerful for its ability to handle multiple
functions at once, using a list. Below, we compute the mean, median, and
standard deviation for <code class="docutils literal notranslate"><span class="pre">bill_count</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">banknotes</span><span class="p">[</span><span class="s2">&quot;current_bill_value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/t5/01_l718x40d70dt2m4lyvrb40000gp/T/ipykernel_49155/3929709255.py:1: FutureWarning: The provided callable &lt;function mean at 0x10df5e8e0&gt; is currently using Series.mean. In a future version of pandas, the provided callable will be used directly. To keep current behavior pass the string &quot;mean&quot; instead.
  banknotes[&quot;current_bill_value&quot;].agg([np.mean, np.median, np.std])
/var/folders/t5/01_l718x40d70dt2m4lyvrb40000gp/T/ipykernel_49155/3929709255.py:1: FutureWarning: The provided callable &lt;function median at 0x1142e3ec0&gt; is currently using Series.median. In a future version of pandas, the provided callable will be used directly. To keep current behavior pass the string &quot;median&quot; instead.
  banknotes[&quot;current_bill_value&quot;].agg([np.mean, np.median, np.std])
/var/folders/t5/01_l718x40d70dt2m4lyvrb40000gp/T/ipykernel_49155/3929709255.py:1: FutureWarning: The provided callable &lt;function std at 0x10df5ea20&gt; is currently using Series.std. In a future version of pandas, the provided callable will be used directly. To keep current behavior pass the string &quot;std&quot; instead.
  banknotes[&quot;current_bill_value&quot;].agg([np.mean, np.median, np.std])
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mean       4038.956989
median      100.000000
std       14336.386917
Name: current_bill_value, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Aggregation methods can also work on multiple columns at once:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">banknotes</span><span class="p">[[</span><span class="s2">&quot;current_bill_value&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled_bill_value&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/t5/01_l718x40d70dt2m4lyvrb40000gp/T/ipykernel_49155/1876906337.py:1: FutureWarning: The provided callable &lt;function mean at 0x10df5e8e0&gt; is currently using DataFrame.mean. In a future version of pandas, the provided callable will be used directly. To keep current behavior pass the string &quot;mean&quot; instead.
  banknotes[[&quot;current_bill_value&quot;, &quot;scaled_bill_value&quot;]].agg(np.mean)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>current_bill_value    4038.956989
scaled_bill_value        0.306058
dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="aggregating-within-groups">
<span id="id3"></span><h3><span class="section-number">3.3.2. </span>Aggregating within Groups<a class="headerlink" href="#aggregating-within-groups" title="Link to this heading">#</a></h3>
<p>Aggregation is especially useful when combined with grouping. The <code class="docutils literal notranslate"><span class="pre">.groupby</span></code>
method groups rows of a DataFrame using the columns you specify. The grouping
columns should generally be categories rather than decimal numbers. For
example, to group the banknotes by <code class="docutils literal notranslate"><span class="pre">gender</span></code> and then count how many entries are
in each group:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">banknotes</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;gender&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>gender
F     59
M    220
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Use bracket notation to look at a specific column for each group:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">banknotes</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;gender&quot;</span><span class="p">)[</span><span class="s2">&quot;current_bill_value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>gender
F    2062.745763
M    4568.940909
Name: current_bill_value, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>It’s also possible to group by multiple conditions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">banknotes</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;gender&quot;</span><span class="p">,</span> <span class="s2">&quot;profession&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>gender  profession      
F       Activist             4
        Head of Gov&#39;t        1
        Monarch              8
        Musician             5
        Other                3
        Performer            1
        Politician           4
        Religious figure     2
        Revolutionary        9
        STEM                 2
        Visual Artist        6
        Writer              14
M       Educator             4
        Founder             45
        Head of Gov&#39;t       42
        Military            13
        Monarch             10
        Musician             7
        Other                2
        Performer            2
        Politician          23
        Religious figure     1
        Revolutionary       19
        STEM                14
        Visual Artist        7
        Writer              31
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>By default, the grouping columns are moved to the index of the result. You can
prevent this by setting <code class="docutils literal notranslate"><span class="pre">as_index</span> <span class="pre">=</span> <span class="pre">False</span></code> in <code class="docutils literal notranslate"><span class="pre">.groupby</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">banknotes</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;gender&quot;</span><span class="p">,</span> <span class="s2">&quot;profession&quot;</span><span class="p">],</span> <span class="n">as_index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>profession</th>
      <th>size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>F</td>
      <td>Activist</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>F</td>
      <td>Head of Gov't</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>F</td>
      <td>Monarch</td>
      <td>8</td>
    </tr>
    <tr>
      <th>3</th>
      <td>F</td>
      <td>Musician</td>
      <td>5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>F</td>
      <td>Other</td>
      <td>3</td>
    </tr>
    <tr>
      <th>5</th>
      <td>F</td>
      <td>Performer</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>F</td>
      <td>Politician</td>
      <td>4</td>
    </tr>
    <tr>
      <th>7</th>
      <td>F</td>
      <td>Religious figure</td>
      <td>2</td>
    </tr>
    <tr>
      <th>8</th>
      <td>F</td>
      <td>Revolutionary</td>
      <td>9</td>
    </tr>
    <tr>
      <th>9</th>
      <td>F</td>
      <td>STEM</td>
      <td>2</td>
    </tr>
    <tr>
      <th>10</th>
      <td>F</td>
      <td>Visual Artist</td>
      <td>6</td>
    </tr>
    <tr>
      <th>11</th>
      <td>F</td>
      <td>Writer</td>
      <td>14</td>
    </tr>
    <tr>
      <th>12</th>
      <td>M</td>
      <td>Educator</td>
      <td>4</td>
    </tr>
    <tr>
      <th>13</th>
      <td>M</td>
      <td>Founder</td>
      <td>45</td>
    </tr>
    <tr>
      <th>14</th>
      <td>M</td>
      <td>Head of Gov't</td>
      <td>42</td>
    </tr>
    <tr>
      <th>15</th>
      <td>M</td>
      <td>Military</td>
      <td>13</td>
    </tr>
    <tr>
      <th>16</th>
      <td>M</td>
      <td>Monarch</td>
      <td>10</td>
    </tr>
    <tr>
      <th>17</th>
      <td>M</td>
      <td>Musician</td>
      <td>7</td>
    </tr>
    <tr>
      <th>18</th>
      <td>M</td>
      <td>Other</td>
      <td>2</td>
    </tr>
    <tr>
      <th>19</th>
      <td>M</td>
      <td>Performer</td>
      <td>2</td>
    </tr>
    <tr>
      <th>20</th>
      <td>M</td>
      <td>Politician</td>
      <td>23</td>
    </tr>
    <tr>
      <th>21</th>
      <td>M</td>
      <td>Religious figure</td>
      <td>1</td>
    </tr>
    <tr>
      <th>22</th>
      <td>M</td>
      <td>Revolutionary</td>
      <td>19</td>
    </tr>
    <tr>
      <th>23</th>
      <td>M</td>
      <td>STEM</td>
      <td>14</td>
    </tr>
    <tr>
      <th>24</th>
      <td>M</td>
      <td>Visual Artist</td>
      <td>7</td>
    </tr>
    <tr>
      <th>25</th>
      <td>M</td>
      <td>Writer</td>
      <td>31</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can also reset the index on a DataFrame, so that the current indexes
become columns with the <code class="docutils literal notranslate"><span class="pre">.reset_index</span></code> method.</p>
</div>
<p>Leaving the grouping columns in the index is often convenient because you can
easily access results for the groups you’re interested in:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">banknotes</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;gender&quot;</span><span class="p">,</span> <span class="s2">&quot;profession&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>

<span class="n">grouped</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Visual Artist&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>gender
F    6
M    7
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>A few aggregation functions only make sense when used together with groups. One
is the <code class="docutils literal notranslate"><span class="pre">.first</span></code> method, which returns the first element or row. The <code class="docutils literal notranslate"><span class="pre">.first</span></code>
method is especially useful if all the values in a group are the same and you
want to reduce the data to one row per group. For instance, the same country
appears across multiple rows in our data set. With <code class="docutils literal notranslate"><span class="pre">.first</span></code>, you can select the
corresponding currency code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">banknotes</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">)[</span><span class="s2">&quot;currency_code&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country
Argentina                 ARS
Australia                 AUD
Bangladesh                BDT
Bolivia                   BOB
Canada                    CAD
Cape Verde                CVE
Chile                     CLP
China                     RMB
Colombia                  COP
Costa Rica                CRC
Czech Republic            CZK
Dominican Republic        DOP
England                   GBP
Georgia                   GEL
Iceland                   ISK
Indonesia                 IDR
Israel                    ILS
Jamaica                   JMD
Japan                     JPY
Kyrgyzstan                KGS
Malawi                    MWK
Mexico                    MXN
New Zealand               NZD
Nigeria                   NGN
Papua New Guinea          PGK
Peru                      PEN
Philippines               PHP
Serbia                    RSD
South Africa              ZAR
South Korea               KRW
Sweden                    SEK
São Tomé and Príncipe     STD
Tunisia                   TND
Turkey                    TRY
Ukraine                   UAH
United States             USD
Uruguay                   UYU
Venezuela                VES​
Name: currency_code, dtype: object
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="data-visualization-in-python">
<span id="id4"></span><h2><span class="section-number">3.4. </span>Data Visualization in Python<a class="headerlink" href="#data-visualization-in-python" title="Link to this heading">#</a></h2>
<img alt="A network of Python visualization packages." src="../_images/visualization_landscape.png" />
<p><em>Image from <a class="reference external" href="http://vanderplas.com/">Jake VanderPlas</a>. See <a class="reference external" href="https://rougier.github.io/python-visualization-landscape/landscape-colors.html">here</a> for a version with links
to all of the packages!</em></p>
<p>Creating aggregated information about a data set is often done with the intent
to share your results. A data visualization is an effective medium for
displaying results, and there are many ways to create one in Python. In fact,
so many visualization packages are available that there is even <a class="reference external" href="https://pyviz.org/">a
website</a> dedicated to helping people decide which to use. This reader
focuses on <strong>static visualization</strong>, where the visualization is a still image.
Some popular packages for creating static visualizations are:</p>
<ul class="simple">
<li><p><strong><a class="reference external" href="https://matplotlib.org/">matplotlib</a></strong> is the foundation for most other visualization packages.
matplotlib is low-level, meaning it’s flexible but even simple plots may take
<a class="reference external" href="https://dsaber.com/2016/10/02/a-dramatic-tour-through-pythons-data-visualization-landscape-including-ggplot-and-altair/">5 lines of code or more</a>. It’s good to know a little bit about
matplotlib, but it probably shouldn’t be your primary visualization package.
Familiarity with MATLAB makes it easier to learn matplotlib.</p></li>
<li><p><strong><a class="reference external" href="https://pandas.pydata.org/docs/user_guide/visualization.html">pandas</a></strong> provides built-in plotting functions, which can be convenient
but are more limited than what you’ll find in dedicated visualization
packages. They’re also inconsistent about the expected format of the data.</p></li>
<li><p><strong><a class="reference external" href="https://plotnine.readthedocs.io/en/stable/">plotnine</a></strong> is a copy of the popular R package <a class="reference external" href="https://ggplot2.tidyverse.org/">ggplot2</a>. The package
uses the <strong>grammar of graphics</strong>, a convenient way to describe visualizations
in terms of layers. Familiarity with R’s <a class="reference external" href="https://ggplot2.tidyverse.org/">ggplot2</a> or Julia’s
<a class="reference external" href="http://gadflyjl.org/stable/">Gadfly.jl</a> package makes it easier to learn plotnine (and
vice-versa).</p></li>
<li><p><strong><a class="reference external" href="https://seaborn.pydata.org/">seaborn</a></strong> is designed specifically for making statistical plots. It’s
well-documented and stable.</p></li>
</ul>
<p>There are also many packages available for making <strong>interactive
visualizations</strong>.</p>
<p>This reader focuses on plotnine, so that the visualization skills you learn
here will also be relevant if you end up using R or Julia. plotnine has
detailed <a class="reference external" href="https://plotnine.readthedocs.io/en/stable/">documentation</a>. It’s also useful to look at the <a class="reference external" href="https://ggplot2.tidyverse.org/">ggplot2
documentation</a> and <a class="reference external" href="https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf">cheatsheet</a>.</p>
</section>
<section id="installing-packages">
<span id="id5"></span><h2><span class="section-number">3.5. </span>Installing Packages<a class="headerlink" href="#installing-packages" title="Link to this heading">#</a></h2>
<p>While Matplotlib is included with Anaconda, plotnine is not. You will need to
install the plotnine package in order to use it.</p>
<p>You can use conda, a standalone program included with Anaconda, to install
packages. To get started, you need to open a <strong>terminal</strong>, a text interface for
running programs on your computer. In JupyterLab, you can open a terminal with
the menu option <code class="docutils literal notranslate"><span class="pre">File</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">New</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Terminal</span></code></p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>A terminal looks a lot like a Python console, but doesn’t accept Python code as
input! To learn more about how to use terminals than we explain here, see
DataLab’s <a class="reference external" href="https://ucdavisdatalab.github.io/workshop_introduction_to_the_command_line/">Introduction to the Unix Command Line workshop reader</a>.</p>
</div>
<p>The command to install a package called <code class="docutils literal notranslate"><span class="pre">PACKAGE</span></code> is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">PACKAGE</span>
</pre></div>
</div>
<p>So you can install plotnine with the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">plotnine</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Conda downloads packages from online <strong>package repositories</strong>. The default
repository is maintained by Anaconda, but the packages there tend to be
slightly out of date. The community maintains another repository, called
conda-forge, that’s updated more frequently and has a wider variety of
packages.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">conda-forge</span></code> tells conda to use the conda-forge package repository.</p>
</div>
<p>You can learn more about conda from the <a class="reference external" href="https://conda.org/">official website</a> and DataLab’s
<a class="reference external" href="https://ucdavisdatalab.github.io/workshop_intermediate_python/chapters/02_reproducible.html#what-s-an-environment">Intermediate Python workshop reader</a>.</p>
<p>After installing plotnine, close the terminal and go back to your Python
console or notebook.</p>
</section>
<section id="preparing-to-visualize">
<span id="id6"></span><h2><span class="section-number">3.6. </span>Preparing to Visualize<a class="headerlink" href="#preparing-to-visualize" title="Link to this heading">#</a></h2>
<p>Before building a visualization, you will need to do a few preparatory steps.</p>
<section id="import-plotnine">
<span id="install-import-plotnine"></span><h3><span class="section-number">3.6.1. </span>Import plotnine<a class="headerlink" href="#import-plotnine" title="Link to this heading">#</a></h3>
<p>In <a class="reference internal" href="01_python-basics.html#modules"><span class="std std-numref">Section 1.4.2</span></a>, you learned how to import a module in a Python package
with the <code class="docutils literal notranslate"><span class="pre">import</span></code> keyword. Python also provides a <code class="docutils literal notranslate"><span class="pre">from</span></code> keyword to import
specific objects from within a module, so that you can access them without the
module name as a prefix. The syntax is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">MODULE</span> <span class="kn">import</span> <span class="n">OBJECT</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">MODULE</span></code> with the name of the module and <code class="docutils literal notranslate"><span class="pre">OBJECT</span></code> with the name of the
object that you want to import.</p>
<p>For instance, if you import Pandas using:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
</pre></div>
</div>
<p>You can then write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">()</span>
</pre></div>
</div>
<p>You can also use the <code class="docutils literal notranslate"><span class="pre">from</span></code> keyword to import all objects in a module with the
wildcard character <code class="docutils literal notranslate"><span class="pre">*</span></code>. Generally you shouldn’t do this, because objects in a
module will overwrite objects in your code if they have the same name. However,
the plotnine package was designed to be imported this way:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plotnine</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="configure-jupyter">
<span id="id7"></span><h3><span class="section-number">3.6.2. </span>Configure Jupyter<a class="headerlink" href="#configure-jupyter" title="Link to this heading">#</a></h3>
<p>Jupyter notebooks can display most static visualizations and some interactive
visualizations. If you’re going to use visualization packages that depend on
Matplotlib (such as plotnine), it’s a good idea to set up your notebook by
running:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The last line sets the default size of plots. You can increase the numbers to
make plots larger, or decrease them to make plots smaller.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In older versions of Jupyter and IPython, it was also necessary to run the
special IPython command <code class="docutils literal notranslate"><span class="pre">%matplotlib</span> <span class="pre">inline</span></code> to set up a notebook for plotting.
This is no longer necessary in modern versions, but you may still see people
use or mention it online. You can read more about this change in <a class="reference external" href="https://stackoverflow.com/questions/65934740/is-matplotlib-inline-still-needed">this
StackOverflow question</a>.</p>
</div>
</section>
<section id="data-cleaning">
<span id="id8"></span><h3><span class="section-number">3.6.3. </span>Data Cleaning<a class="headerlink" href="#data-cleaning" title="Link to this heading">#</a></h3>
<p>Finally, we need to do a small amount of data cleaning. The plots below will
focus on two variables, <code class="docutils literal notranslate"><span class="pre">death_year</span></code> and <code class="docutils literal notranslate"><span class="pre">scaled_bill_value</span></code>. But some rows
lack information for these variables, so they need to be removed. Along the
way, we will ensure that the variables’ datatypes are set correctly.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When making potentially destructive changes to a data set, it’s a good idea to
reassign the altered data to a new variable.</p>
</div>
<p><strong>Death year</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">no_death</span> <span class="o">=</span> <span class="n">banknotes</span><span class="p">[</span><span class="s2">&quot;death_year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">])</span>
<span class="n">to_plot</span> <span class="o">=</span> <span class="n">banknotes</span><span class="p">[</span><span class="n">no_death</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">to_plot</span><span class="p">[</span><span class="s2">&quot;death_year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_plot</span><span class="p">[</span><span class="s2">&quot;death_year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Scaled bill value</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">no_scaled</span> <span class="o">=</span> <span class="n">to_plot</span><span class="p">[</span><span class="s2">&quot;scaled_bill_value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>
<span class="n">to_plot</span> <span class="o">=</span> <span class="n">to_plot</span><span class="p">[</span><span class="n">no_scaled</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>You are now ready to make a plot.</p>
</section>
</section>
<section id="the-grammar-of-graphics">
<span id="grammar-of-graphics"></span><h2><span class="section-number">3.7. </span>The Grammar of Graphics<a class="headerlink" href="#the-grammar-of-graphics" title="Link to this heading">#</a></h2>
<p>Recall that plotnine is a clone of ggplot2. The “gg” in ggplot2 stands for
<em>grammar of graphics</em>. The idea of a grammar of graphics is that visualizations
can be built up in layers. Visualizations that adhere to this grammar must
have:</p>
<ul class="simple">
<li><p>Data</p></li>
<li><p>Geometry</p></li>
<li><p>Aesthetics</p></li>
</ul>
<p>There are also several optional layers. Here are a few:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Layer</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>scales</p></td>
<td class="text-left"><p>Title, label, and axis value settings</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>facets</p></td>
<td class="text-left"><p>Side-by-side plots</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>guides</p></td>
<td class="text-left"><p>Axis and legend position settings</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>annotations</p></td>
<td class="text-left"><p>Shapes that are not mapped to data</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>coordinates</p></td>
<td class="text-left"><p>Coordinate systems (Cartesian, logarithmic, polar)</p></td>
</tr>
</tbody>
</table>
</div>
<p>With all this in mind, it’s time to make a plot. But what kind of plot should
we make? It depends on what we want to know about the data set. Suppose we want
to understand the relationship between a banknote’s value and how long ago the
person on the banknote died, as well as whether this is affected by gender. One
way to show this is to make a scatter plot.</p>
<section id="layer-1-data">
<h3><span class="section-number">3.7.1. </span>Layer 1: Data<a class="headerlink" href="#layer-1-data" title="Link to this heading">#</a></h3>
<p>The data layer determines the data set used to make the plot. plotnine is
designed to work with <em>tidy</em> data. Tidy means:</p>
<ol class="arabic simple">
<li><p>Each observation has its own row</p></li>
<li><p>Each feature has its own column</p></li>
<li><p>Each value has its own cell</p></li>
</ol>
<p>Tidy data sets are convenient in general. A later lesson will cover how to make
an untidy data set tidy. Until then, we’ll take it for granted that the data
sets we work with are tidy.</p>
<p>To set up the data layer, call the ``ggplot` function on a Data Frame:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="n">to_plot</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/fe6ad515cd273bdf0712a4a3a9d00a0c44a32f023adf8a48556a1ffe43656510.png"><img alt="../_images/fe6ad515cd273bdf0712a4a3a9d00a0c44a32f023adf8a48556a1ffe43656510.png" src="../_images/fe6ad515cd273bdf0712a4a3a9d00a0c44a32f023adf8a48556a1ffe43656510.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<p>This returns a blank plot. We still need to add a few more layers.</p>
</section>
<section id="layer-2-geometry">
<h3><span class="section-number">3.7.2. </span>Layer 2: Geometry<a class="headerlink" href="#layer-2-geometry" title="Link to this heading">#</a></h3>
<p>The geometry layer determines the shape or appearance of the visual elements of
the plot. In other words, the geometry layer determines what kind of plot to
make: one with points, lines, boxes, or something else.</p>
<p>There are many different geometries available in plotnine. The package provides
a function for each geometry, always prefixed with <code class="docutils literal notranslate"><span class="pre">geom_</span></code>.</p>
<p>To add a geometry layer to the plot, choose the <code class="docutils literal notranslate"><span class="pre">geom_</span></code> function you want and
add it to the plot with the <code class="docutils literal notranslate"><span class="pre">+</span></code> operator:</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="n">to_plot</span><span class="p">)</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">PlotnineError</span><span class="g g-Whitespace">                             </span>Traceback (most recent call last)
<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/IPython/core/formatters.py:925,</span> in <span class="ni">IPythonDisplayFormatter.__call__</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">923</span> <span class="n">method</span> <span class="o">=</span> <span class="n">get_real_method</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_method</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">924</span> <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">925</span>     <span class="n">method</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">926</span>     <span class="k">return</span> <span class="kc">True</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:141,</span> in <span class="ni">ggplot._ipython_display_</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">134</span> <span class="k">def</span> <span class="nf">_ipython_display_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">135</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">136</span><span class="sd">     Display plot in the output of the cell</span>
<span class="g g-Whitespace">    </span><span class="mi">137</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">138</span><span class="sd">     This method will always be called when a ggplot object is the</span>
<span class="g g-Whitespace">    </span><span class="mi">139</span><span class="sd">     last in the cell.</span>
<span class="g g-Whitespace">    </span><span class="mi">140</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">141</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_display</span><span class="p">()</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:175,</span> in <span class="ni">ggplot._display</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">172</span>     <span class="n">save_format</span> <span class="o">=</span> <span class="s2">&quot;png&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">174</span> <span class="n">buf</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">175</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">save_format</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">176</span> <span class="n">display_func</span> <span class="o">=</span> <span class="n">get_display_function</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">177</span> <span class="n">display_func</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:663,</span> in <span class="ni">ggplot.save</span><span class="nt">(self, filename, format, path, width, height, units, dpi, limitsize, verbose, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">615</span> <span class="k">def</span> <span class="nf">save</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">616</span>     <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">617</span>     <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="n">BytesIO</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">626</span>     <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">627</span> <span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">628</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">629</span><span class="sd">     Save a ggplot object as an image file</span>
<span class="g g-Whitespace">    </span><span class="mi">630</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">661</span><span class="sd">         Additional arguments to pass to matplotlib `savefig()`.</span>
<span class="g g-Whitespace">    </span><span class="mi">662</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">663</span>     <span class="n">sv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_helper</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">664</span>         <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">665</span>         <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">666</span>         <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">667</span>         <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">668</span>         <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">669</span>         <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">670</span>         <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">671</span>         <span class="n">limitsize</span><span class="o">=</span><span class="n">limitsize</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">672</span>         <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">673</span>         <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">674</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">676</span>     <span class="k">with</span> <span class="n">plot_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">rc_context</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">677</span>         <span class="n">sv</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="o">**</span><span class="n">sv</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:612,</span> in <span class="ni">ggplot.save_helper</span><span class="nt">(self, filename, format, path, width, height, units, dpi, limitsize, verbose, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">609</span> <span class="k">if</span> <span class="n">dpi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">610</span>     <span class="bp">self</span><span class="o">.</span><span class="n">theme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theme</span> <span class="o">+</span> <span class="n">theme</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">612</span> <span class="n">figure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">613</span> <span class="k">return</span> <span class="n">mpl_save_view</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">fig_kwargs</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:272,</span> in <span class="ni">ggplot.draw</span><span class="nt">(self, show)</span>
<span class="g g-Whitespace">    </span><span class="mi">270</span> <span class="bp">self</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">271</span> <span class="k">with</span> <span class="n">plot_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">272</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">274</span>     <span class="c1"># setup</span>
<span class="g g-Whitespace">    </span><span class="mi">275</span>     <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facet</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:381,</span> in <span class="ni">ggplot._build</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">377</span> <span class="n">layers</span><span class="o">.</span><span class="n">map_statistic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">379</span> <span class="c1"># Prepare data in geoms</span>
<span class="g g-Whitespace">    </span><span class="mi">380</span> <span class="c1"># e.g. from y and width to ymin and ymax</span>
<span class="ne">--&gt; </span><span class="mi">381</span> <span class="n">layers</span><span class="o">.</span><span class="n">setup_data</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">383</span> <span class="c1"># Apply position adjustments</span>
<span class="g g-Whitespace">    </span><span class="mi">384</span> <span class="n">layers</span><span class="o">.</span><span class="n">compute_position</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/layer.py:447,</span> in <span class="ni">Layers.setup_data</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">445</span> <span class="k">def</span> <span class="nf">setup_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">446</span>     <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">447</span>         <span class="n">l</span><span class="o">.</span><span class="n">setup_data</span><span class="p">()</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/layer.py:325,</span> in <span class="ni">layer.setup_data</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">321</span>     <span class="k">return</span>
<span class="g g-Whitespace">    </span><span class="mi">323</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">setup_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">325</span> <span class="n">check_required_aesthetics</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">326</span>     <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">REQUIRED_AES</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">327</span>     <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">aes_params</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">328</span>     <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">329</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">331</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/_utils/__init__.py:403,</span> in <span class="ni">check_required_aesthetics</span><span class="nt">(required, present, name)</span>
<span class="g g-Whitespace">    </span><span class="mi">401</span> <span class="k">if</span> <span class="n">missing_aes</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">402</span>     <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> requires the following missing aesthetics: </span><span class="si">{}</span><span class="s2">&quot;</span>
<span class="ne">--&gt; </span><span class="mi">403</span>     <span class="k">raise</span> <span class="n">PlotnineError</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing_aes</span><span class="p">)))</span>

<span class="ne">PlotnineError</span>: &#39;geom_point requires the following missing aesthetics: y, x&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/elisehellwig/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/IPython/lib/pretty.py:787: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">PlotnineError</span><span class="g g-Whitespace">                             </span>Traceback (most recent call last)
<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/IPython/core/formatters.py:711,</span> in <span class="ni">PlainTextFormatter.__call__</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">704</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">705</span> <span class="n">printer</span> <span class="o">=</span> <span class="n">pretty</span><span class="o">.</span><span class="n">RepresentationPrinter</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">706</span>     <span class="bp">self</span><span class="o">.</span><span class="n">max_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newline</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">707</span>     <span class="n">max_seq_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_seq_length</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">708</span>     <span class="n">singleton_pprinters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">singleton_printers</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">709</span>     <span class="n">type_pprinters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type_printers</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">710</span>     <span class="n">deferred_pprinters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deferred_printers</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">711</span> <span class="n">printer</span><span class="o">.</span><span class="n">pretty</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">712</span> <span class="n">printer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">713</span> <span class="k">return</span> <span class="n">stream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/IPython/lib/pretty.py:419,</span> in <span class="ni">RepresentationPrinter.pretty</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">408</span>                         <span class="k">return</span> <span class="n">meth</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">cycle</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">409</span>                 <span class="k">if</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">410</span>                     <span class="bp">cls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">object</span>
<span class="g g-Whitespace">    </span><span class="mi">411</span>                     <span class="c1"># check if cls defines __repr__</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">417</span>                     <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">_safe_getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;__repr__&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">418</span>                 <span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">419</span>                     <span class="k">return</span> <span class="n">_repr_pprint</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">cycle</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">421</span>     <span class="k">return</span> <span class="n">_default_pprint</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">cycle</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">422</span> <span class="k">finally</span><span class="p">:</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/IPython/lib/pretty.py:787,</span> in <span class="ni">_repr_pprint</span><span class="nt">(obj, p, cycle)</span>
<span class="g g-Whitespace">    </span><span class="mi">785</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;A pprint that just redirects to the normal repr function.&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">786</span> <span class="c1"># Find newlines and replace them with p.break_()</span>
<span class="ne">--&gt; </span><span class="mi">787</span> <span class="n">output</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">788</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">789</span> <span class="k">with</span> <span class="n">p</span><span class="o">.</span><span class="n">group</span><span class="p">():</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:131,</span> in <span class="ni">ggplot.__repr__</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span> <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">126</span>     <span class="s2">&quot;Using repr(plot) to draw and show the plot figure is &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">127</span>     <span class="s2">&quot;deprecated and will be removed in a future version. &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">128</span>     <span class="s2">&quot;Use plot.show().&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">129</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">130</span> <span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">131</span> <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">132</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Figure Size: (</span><span class="si">{</span><span class="n">W</span><span class="si">}</span><span class="s2"> x </span><span class="si">{</span><span class="n">H</span><span class="si">}</span><span class="s2">)&gt;&quot;</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:150,</span> in <span class="ni">ggplot.show</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">143</span> <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">144</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span><span class="sd">     Show plot using the matplotlib backend set by the user</span>
<span class="g g-Whitespace">    </span><span class="mi">146</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">147</span><span class="sd">     Users should prefer this method instead of printing or repring</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span><span class="sd">     the object.</span>
<span class="g g-Whitespace">    </span><span class="mi">149</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">150</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_display</span><span class="p">()</span> <span class="k">if</span> <span class="n">is_inline_backend</span><span class="p">()</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:175,</span> in <span class="ni">ggplot._display</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">172</span>     <span class="n">save_format</span> <span class="o">=</span> <span class="s2">&quot;png&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">174</span> <span class="n">buf</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">175</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">save_format</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">176</span> <span class="n">display_func</span> <span class="o">=</span> <span class="n">get_display_function</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">177</span> <span class="n">display_func</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:663,</span> in <span class="ni">ggplot.save</span><span class="nt">(self, filename, format, path, width, height, units, dpi, limitsize, verbose, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">615</span> <span class="k">def</span> <span class="nf">save</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">616</span>     <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">617</span>     <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="n">BytesIO</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">626</span>     <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">627</span> <span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">628</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">629</span><span class="sd">     Save a ggplot object as an image file</span>
<span class="g g-Whitespace">    </span><span class="mi">630</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">661</span><span class="sd">         Additional arguments to pass to matplotlib `savefig()`.</span>
<span class="g g-Whitespace">    </span><span class="mi">662</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">663</span>     <span class="n">sv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_helper</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">664</span>         <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">665</span>         <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">666</span>         <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">667</span>         <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">668</span>         <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">669</span>         <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">670</span>         <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">671</span>         <span class="n">limitsize</span><span class="o">=</span><span class="n">limitsize</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">672</span>         <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">673</span>         <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">674</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">676</span>     <span class="k">with</span> <span class="n">plot_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">rc_context</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">677</span>         <span class="n">sv</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="o">**</span><span class="n">sv</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:612,</span> in <span class="ni">ggplot.save_helper</span><span class="nt">(self, filename, format, path, width, height, units, dpi, limitsize, verbose, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">609</span> <span class="k">if</span> <span class="n">dpi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">610</span>     <span class="bp">self</span><span class="o">.</span><span class="n">theme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theme</span> <span class="o">+</span> <span class="n">theme</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">612</span> <span class="n">figure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">613</span> <span class="k">return</span> <span class="n">mpl_save_view</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">fig_kwargs</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:272,</span> in <span class="ni">ggplot.draw</span><span class="nt">(self, show)</span>
<span class="g g-Whitespace">    </span><span class="mi">270</span> <span class="bp">self</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">271</span> <span class="k">with</span> <span class="n">plot_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">272</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">274</span>     <span class="c1"># setup</span>
<span class="g g-Whitespace">    </span><span class="mi">275</span>     <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facet</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:381,</span> in <span class="ni">ggplot._build</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">377</span> <span class="n">layers</span><span class="o">.</span><span class="n">map_statistic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">379</span> <span class="c1"># Prepare data in geoms</span>
<span class="g g-Whitespace">    </span><span class="mi">380</span> <span class="c1"># e.g. from y and width to ymin and ymax</span>
<span class="ne">--&gt; </span><span class="mi">381</span> <span class="n">layers</span><span class="o">.</span><span class="n">setup_data</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">383</span> <span class="c1"># Apply position adjustments</span>
<span class="g g-Whitespace">    </span><span class="mi">384</span> <span class="n">layers</span><span class="o">.</span><span class="n">compute_position</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/layer.py:447,</span> in <span class="ni">Layers.setup_data</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">445</span> <span class="k">def</span> <span class="nf">setup_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">446</span>     <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">447</span>         <span class="n">l</span><span class="o">.</span><span class="n">setup_data</span><span class="p">()</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/layer.py:325,</span> in <span class="ni">layer.setup_data</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">321</span>     <span class="k">return</span>
<span class="g g-Whitespace">    </span><span class="mi">323</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">setup_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">325</span> <span class="n">check_required_aesthetics</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">326</span>     <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">REQUIRED_AES</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">327</span>     <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">aes_params</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">328</span>     <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">329</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">331</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/_utils/__init__.py:403,</span> in <span class="ni">check_required_aesthetics</span><span class="nt">(required, present, name)</span>
<span class="g g-Whitespace">    </span><span class="mi">401</span> <span class="k">if</span> <span class="n">missing_aes</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">402</span>     <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> requires the following missing aesthetics: </span><span class="si">{}</span><span class="s2">&quot;</span>
<span class="ne">--&gt; </span><span class="mi">403</span>     <span class="k">raise</span> <span class="n">PlotnineError</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing_aes</span><span class="p">)))</span>

<span class="ne">PlotnineError</span>: &#39;geom_point requires the following missing aesthetics: y, x&#39;
</pre></div>
</div>
</div>
</div>
<p>This returns an error message that we’re missing aesthetics <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>. We’ll
learn more about aesthetics in the next section, but this error message is
especially helpful: it tells us exactly what we’re missing. When you use a
geometry you’re unfamiliar with, it can be helpful to run the code for just the
data and geometry layer like this, to see exactly which aesthetics need to be
set.</p>
<p>As we’ll see later, it’s possible to add multiple geometries to a plot.</p>
</section>
<section id="layer-3-aesthetics">
<h3><span class="section-number">3.7.3. </span>Layer 3: Aesthetics<a class="headerlink" href="#layer-3-aesthetics" title="Link to this heading">#</a></h3>
<p>The aesthetic layer determines the relationship between the data and the
geometry. Use the aesthetic layer to map features in the data to aesthetics
(visual elements) of the geometry.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">aes</span></code> function creates an aesthetic layer. The syntax is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">aes</span><span class="p">(</span><span class="n">AESTHETIC</span> <span class="o">=</span> <span class="n">FEATURE</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>The names of the aesthetics depend on the geometry, but some common ones are
<code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">color</span></code>, <code class="docutils literal notranslate"><span class="pre">fill</span></code>, <code class="docutils literal notranslate"><span class="pre">shape</span></code>, and <code class="docutils literal notranslate"><span class="pre">size</span></code>. There is more information about
and examples of aesthetic names in the documentation.</p>
<p>For example, we want to put <code class="docutils literal notranslate"><span class="pre">death_year</span></code> on the x-axis and <code class="docutils literal notranslate"><span class="pre">scalled_bill_value</span></code>
on the y-axis. It’s best to use <code class="docutils literal notranslate"><span class="pre">scaled_bill_value</span></code> here rather than
<code class="docutils literal notranslate"><span class="pre">current_bill_value</span></code> because different countries use different scales of
curency. One United States Dollar is worth approximately one hundred Japanese
Yen, for example. Below, we will set the aesthetics for both of these values.
Notice however that the aesthetic layer is not added to the plot with the <code class="docutils literal notranslate"><span class="pre">+</span></code>
operator. Instead, it is passed as the second argument to the <code class="docutils literal notranslate"><span class="pre">ggplot</span></code>
function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ggplot</span><span class="p">(</span>
    <span class="n">to_plot</span><span class="p">,</span>
    <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;death_year&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;scaled_bill_value&quot;</span><span class="p">)</span>
<span class="p">)</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/7dc01b6236a421f2d83416dc8aad7c09a00217538fb5f40e38c0e582196d537e.png"><img alt="../_images/7dc01b6236a421f2d83416dc8aad7c09a00217538fb5f40e38c0e582196d537e.png" src="../_images/7dc01b6236a421f2d83416dc8aad7c09a00217538fb5f40e38c0e582196d537e.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<p><strong>Per-geometry Aesthetics</strong></p>
<p>When you add the aesthetic layer or pass it to the <code class="docutils literal notranslate"><span class="pre">ggplot</span></code> function, it
applies to the entire plot. You can also set an aesthetic layer individually
for each geometry by passing the layer as the first argument in the <code class="docutils literal notranslate"><span class="pre">geom_</span></code>
function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">to_plot</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;death_year&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;scaled_bill_value&quot;</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/7dc01b6236a421f2d83416dc8aad7c09a00217538fb5f40e38c0e582196d537e.png"><img alt="../_images/7dc01b6236a421f2d83416dc8aad7c09a00217538fb5f40e38c0e582196d537e.png" src="../_images/7dc01b6236a421f2d83416dc8aad7c09a00217538fb5f40e38c0e582196d537e.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Enclose expressions with <code class="docutils literal notranslate"><span class="pre">()</span></code> to create multiline code. It would be possible to
write out all of the above on one line, but this would come at the expense of
readability.</p>
</div>
<p>This is really only useful when you have multiple geometries. As an example,
let’s color-code the points by gender. To do so, we need to convert <code class="docutils literal notranslate"><span class="pre">gender</span></code> to
<em>categorical</em> data, which measures a qualitative category.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">to_plot</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;death_year&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;scaled_bill_value&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;factor(gender)&quot;</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/3b07296ee00261a2afef33e1eabca94d709e6e54a4adbc649f550a635877f450.png"><img alt="../_images/3b07296ee00261a2afef33e1eabca94d709e6e54a4adbc649f550a635877f450.png" src="../_images/3b07296ee00261a2afef33e1eabca94d709e6e54a4adbc649f550a635877f450.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<p>Now let’s add labels to each point. To do this, we need to add another
geometry:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">to_plot</span><span class="p">,</span>
    <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;death_year&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;scaled_bill_value&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;factor(gender)&quot;</span><span class="p">,</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span><span class="p">))</span> <span class="o">+</span>
    <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span> 
    <span class="n">geom_text</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/57d5276b527a53a89eece48acdd642b985ed3c3351b105a28d6a14738895ac36.png"><img alt="../_images/57d5276b527a53a89eece48acdd642b985ed3c3351b105a28d6a14738895ac36.png" src="../_images/57d5276b527a53a89eece48acdd642b985ed3c3351b105a28d6a14738895ac36.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<p>Where you put the aesthetics matters:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">to_plot</span><span class="p">,</span>
    <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;death_year&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;scaled_bill_value&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span><span class="p">))</span> <span class="o">+</span> 
    <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span> 
    <span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;factor(gender)&quot;</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/40573cf9298787d4963c022388377bed3ce7f0244b04e4b07df32225f2328c98.png"><img alt="../_images/40573cf9298787d4963c022388377bed3ce7f0244b04e4b07df32225f2328c98.png" src="../_images/40573cf9298787d4963c022388377bed3ce7f0244b04e4b07df32225f2328c98.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<p><strong>Constant Aesthetics</strong></p>
<p>If you want to set an aesthetic to a constant value, rather than one that’s
data dependent, do so in the geometry layer rather than the aesthetic layer.
For instance, suppose you want to use point shape rather than color to indicate
gender, and you want to make all of the points blue.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">to_plot</span><span class="p">,</span>
    <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;death_year&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;scaled_bill_value&quot;</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="s2">&quot;factor(gender)&quot;</span><span class="p">))</span> <span class="o">+</span>
    <span class="n">geom_point</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/c8e2d91120bd6adcab68566cbb53cc618d63e850840ff59aa56b2f3414ab8040.png"><img alt="../_images/c8e2d91120bd6adcab68566cbb53cc618d63e850840ff59aa56b2f3414ab8040.png" src="../_images/c8e2d91120bd6adcab68566cbb53cc618d63e850840ff59aa56b2f3414ab8040.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<p>If you set an aesthetic to a constant value inside of the aesthetic layer, the
results you get might not be what you expect:</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">to_plot</span><span class="p">,</span>
    <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;death_year&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;scaled_bill_value&quot;</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="s2">&quot;factor(gender)&quot;</span><span class="p">,</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">))</span> <span class="o">+</span>
    <span class="n">geom_point</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/mapping/evaluation.py:223,</span> in <span class="ni">evaluate</span><span class="nt">(aesthetics, data, env)</span>
<span class="g g-Whitespace">    </span><span class="mi">222</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">223</span>     <span class="n">new_val</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">inner_namespace</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">224</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/mapping/_env.py:69,</span> in <span class="ni">Environment.eval</span><span class="nt">(self, expr, inner_namespace)</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span> <span class="n">code</span> <span class="o">=</span> <span class="n">_compile_eval</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">69</span> <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>     <span class="n">code</span><span class="p">,</span> <span class="p">{},</span> <span class="n">StackedLookup</span><span class="p">([</span><span class="n">inner_namespace</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespaces</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span> <span class="p">)</span>

<span class="n">File</span> <span class="o">&lt;</span><span class="n">string</span><span class="o">-</span><span class="n">expression</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">1</span>

<span class="ne">NameError</span>: name &#39;blue&#39; is not defined

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">PlotnineError</span><span class="g g-Whitespace">                             </span>Traceback (most recent call last)
<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/IPython/core/formatters.py:925,</span> in <span class="ni">IPythonDisplayFormatter.__call__</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">923</span> <span class="n">method</span> <span class="o">=</span> <span class="n">get_real_method</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_method</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">924</span> <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">925</span>     <span class="n">method</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">926</span>     <span class="k">return</span> <span class="kc">True</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:141,</span> in <span class="ni">ggplot._ipython_display_</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">134</span> <span class="k">def</span> <span class="nf">_ipython_display_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">135</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">136</span><span class="sd">     Display plot in the output of the cell</span>
<span class="g g-Whitespace">    </span><span class="mi">137</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">138</span><span class="sd">     This method will always be called when a ggplot object is the</span>
<span class="g g-Whitespace">    </span><span class="mi">139</span><span class="sd">     last in the cell.</span>
<span class="g g-Whitespace">    </span><span class="mi">140</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">141</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_display</span><span class="p">()</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:175,</span> in <span class="ni">ggplot._display</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">172</span>     <span class="n">save_format</span> <span class="o">=</span> <span class="s2">&quot;png&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">174</span> <span class="n">buf</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">175</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">save_format</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">176</span> <span class="n">display_func</span> <span class="o">=</span> <span class="n">get_display_function</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">177</span> <span class="n">display_func</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:663,</span> in <span class="ni">ggplot.save</span><span class="nt">(self, filename, format, path, width, height, units, dpi, limitsize, verbose, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">615</span> <span class="k">def</span> <span class="nf">save</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">616</span>     <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">617</span>     <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="n">BytesIO</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">626</span>     <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">627</span> <span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">628</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">629</span><span class="sd">     Save a ggplot object as an image file</span>
<span class="g g-Whitespace">    </span><span class="mi">630</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">661</span><span class="sd">         Additional arguments to pass to matplotlib `savefig()`.</span>
<span class="g g-Whitespace">    </span><span class="mi">662</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">663</span>     <span class="n">sv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_helper</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">664</span>         <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">665</span>         <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">666</span>         <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">667</span>         <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">668</span>         <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">669</span>         <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">670</span>         <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">671</span>         <span class="n">limitsize</span><span class="o">=</span><span class="n">limitsize</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">672</span>         <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">673</span>         <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">674</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">676</span>     <span class="k">with</span> <span class="n">plot_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">rc_context</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">677</span>         <span class="n">sv</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="o">**</span><span class="n">sv</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:612,</span> in <span class="ni">ggplot.save_helper</span><span class="nt">(self, filename, format, path, width, height, units, dpi, limitsize, verbose, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">609</span> <span class="k">if</span> <span class="n">dpi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">610</span>     <span class="bp">self</span><span class="o">.</span><span class="n">theme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theme</span> <span class="o">+</span> <span class="n">theme</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">612</span> <span class="n">figure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">613</span> <span class="k">return</span> <span class="n">mpl_save_view</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">fig_kwargs</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:272,</span> in <span class="ni">ggplot.draw</span><span class="nt">(self, show)</span>
<span class="g g-Whitespace">    </span><span class="mi">270</span> <span class="bp">self</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">271</span> <span class="k">with</span> <span class="n">plot_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">272</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">274</span>     <span class="c1"># setup</span>
<span class="g g-Whitespace">    </span><span class="mi">275</span>     <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facet</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:362,</span> in <span class="ni">ggplot._build</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">358</span> <span class="n">layout</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">360</span> <span class="c1"># Compute aesthetics to produce data with generalised</span>
<span class="g g-Whitespace">    </span><span class="mi">361</span> <span class="c1"># variable names</span>
<span class="ne">--&gt; </span><span class="mi">362</span> <span class="n">layers</span><span class="o">.</span><span class="n">compute_aesthetics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">364</span> <span class="c1"># Transform data using all scales</span>
<span class="g g-Whitespace">    </span><span class="mi">365</span> <span class="n">layers</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/layer.py:457,</span> in <span class="ni">Layers.compute_aesthetics</span><span class="nt">(self, plot)</span>
<span class="g g-Whitespace">    </span><span class="mi">455</span> <span class="k">def</span> <span class="nf">compute_aesthetics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="n">ggplot</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">456</span>     <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">457</span>         <span class="n">l</span><span class="o">.</span><span class="n">compute_aesthetics</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/layer.py:260,</span> in <span class="ni">layer.compute_aesthetics</span><span class="nt">(self, plot)</span>
<span class="g g-Whitespace">    </span><span class="mi">253</span> <span class="k">def</span> <span class="nf">compute_aesthetics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="n">ggplot</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">254</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">255</span><span class="sd">     Return a dataframe where the columns match the aesthetic mappings</span>
<span class="g g-Whitespace">    </span><span class="mi">256</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">257</span><span class="sd">     Transformations like &#39;factor(cyl)&#39; and other</span>
<span class="g g-Whitespace">    </span><span class="mi">258</span><span class="sd">     expression evaluation are  made in here</span>
<span class="g g-Whitespace">    </span><span class="mi">259</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">260</span>     <span class="n">evaled</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">_starting</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">plot</span><span class="o">.</span><span class="n">environment</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">261</span>     <span class="n">evaled_aes</span> <span class="o">=</span> <span class="n">aes</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">):</span> <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">evaled</span><span class="p">})</span>
<span class="g g-Whitespace">    </span><span class="mi">262</span>     <span class="n">plot</span><span class="o">.</span><span class="n">scales</span><span class="o">.</span><span class="n">add_defaults</span><span class="p">(</span><span class="n">evaled</span><span class="p">,</span> <span class="n">evaled_aes</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/mapping/evaluation.py:226,</span> in <span class="ni">evaluate</span><span class="nt">(aesthetics, data, env)</span>
<span class="g g-Whitespace">    </span><span class="mi">224</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">225</span>     <span class="n">msg</span> <span class="o">=</span> <span class="n">_TPL_EVAL_FAIL</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ae</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<span class="ne">--&gt; </span><span class="mi">226</span>     <span class="k">raise</span> <span class="n">PlotnineError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
<span class="g g-Whitespace">    </span><span class="mi">228</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">229</span>     <span class="n">evaled</span><span class="p">[</span><span class="n">ae</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_val</span>

<span class="ne">PlotnineError</span>: &quot;Could not evaluate the &#39;color&#39; mapping: &#39;blue&#39; (original error: name &#39;blue&#39; is not defined)&quot;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/elisehellwig/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/IPython/lib/pretty.py:787: FutureWarning: Using repr(plot) to draw and show the plot figure is deprecated and will be removed in a future version. Use plot.show().
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/mapping/evaluation.py:223,</span> in <span class="ni">evaluate</span><span class="nt">(aesthetics, data, env)</span>
<span class="g g-Whitespace">    </span><span class="mi">222</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">223</span>     <span class="n">new_val</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">inner_namespace</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">224</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/mapping/_env.py:69,</span> in <span class="ni">Environment.eval</span><span class="nt">(self, expr, inner_namespace)</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span> <span class="n">code</span> <span class="o">=</span> <span class="n">_compile_eval</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">69</span> <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>     <span class="n">code</span><span class="p">,</span> <span class="p">{},</span> <span class="n">StackedLookup</span><span class="p">([</span><span class="n">inner_namespace</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespaces</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span> <span class="p">)</span>

<span class="n">File</span> <span class="o">&lt;</span><span class="n">string</span><span class="o">-</span><span class="n">expression</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">1</span>

<span class="ne">NameError</span>: name &#39;blue&#39; is not defined

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">PlotnineError</span><span class="g g-Whitespace">                             </span>Traceback (most recent call last)
<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/IPython/core/formatters.py:711,</span> in <span class="ni">PlainTextFormatter.__call__</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">704</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">705</span> <span class="n">printer</span> <span class="o">=</span> <span class="n">pretty</span><span class="o">.</span><span class="n">RepresentationPrinter</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">706</span>     <span class="bp">self</span><span class="o">.</span><span class="n">max_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newline</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">707</span>     <span class="n">max_seq_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_seq_length</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">708</span>     <span class="n">singleton_pprinters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">singleton_printers</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">709</span>     <span class="n">type_pprinters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type_printers</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">710</span>     <span class="n">deferred_pprinters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deferred_printers</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">711</span> <span class="n">printer</span><span class="o">.</span><span class="n">pretty</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">712</span> <span class="n">printer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">713</span> <span class="k">return</span> <span class="n">stream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/IPython/lib/pretty.py:419,</span> in <span class="ni">RepresentationPrinter.pretty</span><span class="nt">(self, obj)</span>
<span class="g g-Whitespace">    </span><span class="mi">408</span>                         <span class="k">return</span> <span class="n">meth</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">cycle</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">409</span>                 <span class="k">if</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">410</span>                     <span class="bp">cls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">object</span>
<span class="g g-Whitespace">    </span><span class="mi">411</span>                     <span class="c1"># check if cls defines __repr__</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">417</span>                     <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">_safe_getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;__repr__&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">418</span>                 <span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">419</span>                     <span class="k">return</span> <span class="n">_repr_pprint</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">cycle</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">421</span>     <span class="k">return</span> <span class="n">_default_pprint</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">cycle</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">422</span> <span class="k">finally</span><span class="p">:</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/IPython/lib/pretty.py:787,</span> in <span class="ni">_repr_pprint</span><span class="nt">(obj, p, cycle)</span>
<span class="g g-Whitespace">    </span><span class="mi">785</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;A pprint that just redirects to the normal repr function.&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">786</span> <span class="c1"># Find newlines and replace them with p.break_()</span>
<span class="ne">--&gt; </span><span class="mi">787</span> <span class="n">output</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">788</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">789</span> <span class="k">with</span> <span class="n">p</span><span class="o">.</span><span class="n">group</span><span class="p">():</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:131,</span> in <span class="ni">ggplot.__repr__</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span> <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">126</span>     <span class="s2">&quot;Using repr(plot) to draw and show the plot figure is &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">127</span>     <span class="s2">&quot;deprecated and will be removed in a future version. &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">128</span>     <span class="s2">&quot;Use plot.show().&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">129</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">130</span> <span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">131</span> <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">132</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Figure Size: (</span><span class="si">{</span><span class="n">W</span><span class="si">}</span><span class="s2"> x </span><span class="si">{</span><span class="n">H</span><span class="si">}</span><span class="s2">)&gt;&quot;</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:150,</span> in <span class="ni">ggplot.show</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">143</span> <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">144</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span><span class="sd">     Show plot using the matplotlib backend set by the user</span>
<span class="g g-Whitespace">    </span><span class="mi">146</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">147</span><span class="sd">     Users should prefer this method instead of printing or repring</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span><span class="sd">     the object.</span>
<span class="g g-Whitespace">    </span><span class="mi">149</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">150</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_display</span><span class="p">()</span> <span class="k">if</span> <span class="n">is_inline_backend</span><span class="p">()</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:175,</span> in <span class="ni">ggplot._display</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">172</span>     <span class="n">save_format</span> <span class="o">=</span> <span class="s2">&quot;png&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">174</span> <span class="n">buf</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">175</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">save_format</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">176</span> <span class="n">display_func</span> <span class="o">=</span> <span class="n">get_display_function</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">177</span> <span class="n">display_func</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:663,</span> in <span class="ni">ggplot.save</span><span class="nt">(self, filename, format, path, width, height, units, dpi, limitsize, verbose, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">615</span> <span class="k">def</span> <span class="nf">save</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">616</span>     <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">617</span>     <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="n">BytesIO</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">626</span>     <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">627</span> <span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">628</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">629</span><span class="sd">     Save a ggplot object as an image file</span>
<span class="g g-Whitespace">    </span><span class="mi">630</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">661</span><span class="sd">         Additional arguments to pass to matplotlib `savefig()`.</span>
<span class="g g-Whitespace">    </span><span class="mi">662</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">663</span>     <span class="n">sv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_helper</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">664</span>         <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">665</span>         <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">666</span>         <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">667</span>         <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">668</span>         <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">669</span>         <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">670</span>         <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">671</span>         <span class="n">limitsize</span><span class="o">=</span><span class="n">limitsize</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">672</span>         <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">673</span>         <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">674</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">676</span>     <span class="k">with</span> <span class="n">plot_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">rc_context</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">677</span>         <span class="n">sv</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="o">**</span><span class="n">sv</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:612,</span> in <span class="ni">ggplot.save_helper</span><span class="nt">(self, filename, format, path, width, height, units, dpi, limitsize, verbose, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">609</span> <span class="k">if</span> <span class="n">dpi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">610</span>     <span class="bp">self</span><span class="o">.</span><span class="n">theme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theme</span> <span class="o">+</span> <span class="n">theme</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">612</span> <span class="n">figure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">613</span> <span class="k">return</span> <span class="n">mpl_save_view</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">fig_kwargs</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:272,</span> in <span class="ni">ggplot.draw</span><span class="nt">(self, show)</span>
<span class="g g-Whitespace">    </span><span class="mi">270</span> <span class="bp">self</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">271</span> <span class="k">with</span> <span class="n">plot_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">272</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">274</span>     <span class="c1"># setup</span>
<span class="g g-Whitespace">    </span><span class="mi">275</span>     <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facet</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/ggplot.py:362,</span> in <span class="ni">ggplot._build</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">358</span> <span class="n">layout</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">360</span> <span class="c1"># Compute aesthetics to produce data with generalised</span>
<span class="g g-Whitespace">    </span><span class="mi">361</span> <span class="c1"># variable names</span>
<span class="ne">--&gt; </span><span class="mi">362</span> <span class="n">layers</span><span class="o">.</span><span class="n">compute_aesthetics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">364</span> <span class="c1"># Transform data using all scales</span>
<span class="g g-Whitespace">    </span><span class="mi">365</span> <span class="n">layers</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/layer.py:457,</span> in <span class="ni">Layers.compute_aesthetics</span><span class="nt">(self, plot)</span>
<span class="g g-Whitespace">    </span><span class="mi">455</span> <span class="k">def</span> <span class="nf">compute_aesthetics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="n">ggplot</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">456</span>     <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">457</span>         <span class="n">l</span><span class="o">.</span><span class="n">compute_aesthetics</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/layer.py:260,</span> in <span class="ni">layer.compute_aesthetics</span><span class="nt">(self, plot)</span>
<span class="g g-Whitespace">    </span><span class="mi">253</span> <span class="k">def</span> <span class="nf">compute_aesthetics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="n">ggplot</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">254</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">255</span><span class="sd">     Return a dataframe where the columns match the aesthetic mappings</span>
<span class="g g-Whitespace">    </span><span class="mi">256</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">257</span><span class="sd">     Transformations like &#39;factor(cyl)&#39; and other</span>
<span class="g g-Whitespace">    </span><span class="mi">258</span><span class="sd">     expression evaluation are  made in here</span>
<span class="g g-Whitespace">    </span><span class="mi">259</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">260</span>     <span class="n">evaled</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">_starting</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">plot</span><span class="o">.</span><span class="n">environment</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">261</span>     <span class="n">evaled_aes</span> <span class="o">=</span> <span class="n">aes</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">):</span> <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">evaled</span><span class="p">})</span>
<span class="g g-Whitespace">    </span><span class="mi">262</span>     <span class="n">plot</span><span class="o">.</span><span class="n">scales</span><span class="o">.</span><span class="n">add_defaults</span><span class="p">(</span><span class="n">evaled</span><span class="p">,</span> <span class="n">evaled_aes</span><span class="p">)</span>

<span class="nn">File ~/Teaching/workshop_python_basics/.pixi/envs/default/lib/python3.12/site-packages/plotnine/mapping/evaluation.py:226,</span> in <span class="ni">evaluate</span><span class="nt">(aesthetics, data, env)</span>
<span class="g g-Whitespace">    </span><span class="mi">224</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">225</span>     <span class="n">msg</span> <span class="o">=</span> <span class="n">_TPL_EVAL_FAIL</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ae</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<span class="ne">--&gt; </span><span class="mi">226</span>     <span class="k">raise</span> <span class="n">PlotnineError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
<span class="g g-Whitespace">    </span><span class="mi">228</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">229</span>     <span class="n">evaled</span><span class="p">[</span><span class="n">ae</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_val</span>

<span class="ne">PlotnineError</span>: &quot;Could not evaluate the &#39;color&#39; mapping: &#39;blue&#39; (original error: name &#39;blue&#39; is not defined)&quot;
</pre></div>
</div>
</div>
</div>
</section>
<section id="layer-4-scales">
<h3><span class="section-number">3.7.4. </span>Layer 4: Scales<a class="headerlink" href="#layer-4-scales" title="Link to this heading">#</a></h3>
<p>The scales layer controls the title, axis labels, and axis scales of the plot.
Most of the functions in the scales layer are prefixed with <code class="docutils literal notranslate"><span class="pre">scale_</span></code>, but not
all of them.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">labs</span></code> function is especially important, because it’s used to set the title
and axis labels. All graphs need a title and axis labels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">to_plot</span><span class="p">,</span>
    <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;death_year&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;scaled_bill_value&quot;</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="s2">&quot;factor(gender)&quot;</span><span class="p">))</span> <span class="o">+</span> 
    <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;Death Year&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;Scaled Bill Value&quot;</span><span class="p">,</span>
         <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Does death year affect bill value?&quot;</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="s2">&quot;Gender&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/9638a2510f593dba39ee1f31137e7815d4ab8c7721d25afc3ec0b99c8fc83f3e.png"><img alt="../_images/9638a2510f593dba39ee1f31137e7815d4ab8c7721d25afc3ec0b99c8fc83f3e.png" src="../_images/9638a2510f593dba39ee1f31137e7815d4ab8c7721d25afc3ec0b99c8fc83f3e.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
</section>
<section id="saving-plots">
<h3><span class="section-number">3.7.5. </span>Saving Plots<a class="headerlink" href="#saving-plots" title="Link to this heading">#</a></h3>
<p>If you assign a plot to a variable, you can use the <code class="docutils literal notranslate"><span class="pre">save</span></code> method or the
<code class="docutils literal notranslate"><span class="pre">ggsave</span></code> function to save that plot to a file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">to_plot</span><span class="p">,</span>
    <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;death_year&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;scaled_bill_value&quot;</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="s2">&quot;factor(gender)&quot;</span><span class="p">))</span> <span class="o">+</span>
    <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;Death Year&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;Scaled Bill Value&quot;</span><span class="p">,</span> 
         <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Does death year affect bill value?&quot;</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="s2">&quot;Gender&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">ggsave</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="s2">&quot;myplot.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The file format is selected automatically based on the extension. Common
formats are PNG and PDF.</p>
</section>
<section id="example-bar-plot">
<span id="id9"></span><h3><span class="section-number">3.7.6. </span>Example: Bar Plot<a class="headerlink" href="#example-bar-plot" title="Link to this heading">#</a></h3>
<p>Now suppose you want to plot the number of banknotes with people from each
profession in the banknotes data set. A bar plot is an appropriate way to
represent this visually.</p>
<p>The geometry for a bar plot is <code class="docutils literal notranslate"><span class="pre">geom_bar</span></code>. Since bar plots are mainly used to
display frequencies, the <code class="docutils literal notranslate"><span class="pre">geom_bar</span></code> function automatically computes frequencies
when used in conjunction with the <code class="docutils literal notranslate"><span class="pre">factor()</span></code> syntax from above.</p>
<p>We can also use a fill color to further breakdown the bars by gender. Here’s
the code to make the bar plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">to_plot</span><span class="p">,</span>
    <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;factor(profession)&quot;</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;factor(gender)&quot;</span><span class="p">))</span> <span class="o">+</span>
    <span class="n">geom_bar</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="s2">&quot;dodge&quot;</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">theme</span><span class="p">(</span><span class="n">axis_text_x</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">90</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/6b63f3014e7b3bbd8d6b6c56f41bf93057aa92704a0599ffe6423034c7b4e790.png"><img alt="../_images/6b63f3014e7b3bbd8d6b6c56f41bf93057aa92704a0599ffe6423034c7b4e790.png" src="../_images/6b63f3014e7b3bbd8d6b6c56f41bf93057aa92704a0599ffe6423034c7b4e790.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<p>The setting <code class="docutils literal notranslate"><span class="pre">position</span> <span class="pre">=</span> <span class="pre">&quot;dodge&quot;</span></code> instructs <code class="docutils literal notranslate"><span class="pre">geom_bar</span></code> to put the bars
side-by-side rather than stacking them. Adding <code class="docutils literal notranslate"><span class="pre">theme</span></code> allows you to change how
the axis labels and ticks are formatted.</p>
<p>In some cases, you may want to make a bar plot with frequencies you’ve already
computed. To prevent <code class="docutils literal notranslate"><span class="pre">geom_bar</span></code> from computing frequencies automatically, set
<code class="docutils literal notranslate"><span class="pre">stat</span> <span class="pre">=</span> <span class="pre">&quot;identity&quot;</span></code>.</p>
</section>
<section id="visualization-design">
<span id="id10"></span><h3><span class="section-number">3.7.7. </span>Visualization Design<a class="headerlink" href="#visualization-design" title="Link to this heading">#</a></h3>
<p>Designing high-quality visualizations goes beyond just mastering which Python
functions to call. You also need to think carefully about what kind of data you
have and what message you want to convey. This section provides a few
guidelines.</p>
<p>The first step in data visualization is choosing an appropriate kind of plot.
Here are some suggestions (not rules):</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Feature 1</p></th>
<th class="head text-left"><p>Feature 2</p></th>
<th class="head text-left"><p>Plot</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>categorical</p></td>
<td class="text-left"><p>categorical</p></td>
<td class="text-left"><p>bar, dot</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>categorical</p></td>
<td class="text-left"><p>categorical</p></td>
<td class="text-left"><p>bar, dot, mosaic</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>numerical</p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>box, density, histogram</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>numerical</p></td>
<td class="text-left"><p>categorical</p></td>
<td class="text-left"><p>box, density, ridge</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>numerical</p></td>
<td class="text-left"><p>numerical</p></td>
<td class="text-left"><p>line, scatter, smooth scatter</p></td>
</tr>
</tbody>
</table>
</div>
<p>If you want to add a:</p>
<ul class="simple">
<li><p>3rd numerical feature, use it to change point/line size</p></li>
<li><p>3rd categorical feature, use it to change point/line style</p></li>
<li><p>4th categorical feature, use side-by-side plots</p></li>
</ul>
<p>Once you’ve selected a plot, here are some rules you should almost always
follow:</p>
<ul class="simple">
<li><p>Always add a title and axis labels. These should be descriptive, not variable
names!</p></li>
<li><p>Specify units after the axis label if the axis has units. For instance,
“Height (ft)”</p></li>
<li><p>Don’t forget that many people are colorblind! Also, plots are often printed
in black and white. Use point and line styles to distinguish groups; color is
optional</p></li>
<li><p>Add a legend whenever you’ve used more than one point or line style</p></li>
<li><p>Always write a few sentences explaining what the plot shows. Don’t describe
the plot, because the reader can just look at it. Instead, explain what they
can learn from the plot and point out important details that may be
overlooked</p></li>
<li><p>For side-by-side plots, use the same axis scales for both plots so that
comparing them is not deceptive</p></li>
</ul>
<p>Visualization design is a deep topic, and whole books have been written about
it. One resource where you can learn more is DataLab’s <a class="reference external" href="https://ucdavisdatalab.github.io/workshop_data_viz_principles/">Principle’s of Data
Visualization Workshop Reader</a>.</p>
</section>
</section>
<section id="exercises">
<h2><span class="section-number">3.8. </span>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<section id="exercise">
<h3><span class="section-number">3.8.1. </span>Exercise<a class="headerlink" href="#exercise" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Compute the number of banknotes that feature a person who died before 1990.</p></li>
<li><p>Of those people, how many were activists?</p></li>
</ol>
</section>
<section id="id11">
<h3><span class="section-number">3.8.2. </span>Exercise<a class="headerlink" href="#id11" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Compute the range of <code class="docutils literal notranslate"><span class="pre">first_appearance_year</span></code> for each country.</p>
<ul class="simple">
<li><p>Hint: this would be a good place to try out a multi-function
aggregation…</p></li>
</ul>
</li>
<li><p>How many unique values are there among the first and last values of
<code class="docutils literal notranslate"><span class="pre">first_appearance_year</span></code>?</p></li>
</ol>
</section>
<section id="id12">
<h3><span class="section-number">3.8.3. </span>Exercise<a class="headerlink" href="#id12" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Compute the set of banknotes who died in this century.</p></li>
<li><p>Use plotnine’s <code class="docutils literal notranslate"><span class="pre">geom_segment</span></code> function to create a plot which shows the
timespan between death year and first appearance as a horizontal segment for
each banknote. Put the name of each person on the y-axis. Color code the
segments by gender.</p>
<ul class="simple">
<li><p>Hint: you can make the plot more visually appealing if you first sort the
death year. You can use the <code class="docutils literal notranslate"><span class="pre">.sort_values</span></code> method to sort a DataFrame on
a column, or set of columns. Be aware that the default parameter for one
of the arguments is probably not what you’re expecting.</p></li>
</ul>
</li>
</ol>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="02_pandas-basics.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">2. </span>Data Structures</p>
      </div>
    </a>
    <a class="right-next"
       href="04_organizing-code.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">4. </span>Organizing Code</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">3.1. Setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#packages">3.1.1. Packages</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data">3.1.2. Data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#iterating-over-data">3.2. Iterating Over Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#for-loops">3.2.1. For-Loops</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#list-comprehensions">3.2.2. List Comprehensions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aggregate-functions">3.3. Aggregate Functions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aggregating-a-column">3.3.1. Aggregating a Column</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aggregating-within-groups">3.3.2. Aggregating within Groups</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-visualization-in-python">3.4. Data Visualization in Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-packages">3.5. Installing Packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-to-visualize">3.6. Preparing to Visualize</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-plotnine">3.6.1. Import plotnine</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-jupyter">3.6.2. Configure Jupyter</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-cleaning">3.6.3. Data Cleaning</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-grammar-of-graphics">3.7. The Grammar of Graphics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#layer-1-data">3.7.1. Layer 1: Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#layer-2-geometry">3.7.2. Layer 2: Geometry</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#layer-3-aesthetics">3.7.3. Layer 3: Aesthetics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#layer-4-scales">3.7.4. Layer 4: Scales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-plots">3.7.5. Saving Plots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-bar-plot">3.7.6. Example: Bar Plot</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-design">3.7.7. Visualization Design</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">3.8. Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">3.8.1. Exercise</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">3.8.2. Exercise</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">3.8.3. Exercise</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Arthur Koehl, Tyler Shoemaker, and Nick Ulle
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>